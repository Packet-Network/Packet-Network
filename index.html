<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Packet Network - Network Design Game</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: #16213e;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #0f3460;
    }
    header h1 { font-size: 1.4em; color: #00d9ff; }
    .score-panel {
      display: flex;
      gap: 20px;
    }
    .score-item {
      text-align: center;
    }
    .score-item .label { font-size: 0.75em; color: #888; }
    .score-item .value { font-size: 1.2em; font-weight: bold; }
    .main-container {
      display: flex;
      flex: 1;
    }
    /* ========== NEW COMPACT SIDEBAR ========== */
    .toolbar {
      width: 90px;
      background: #16213e;
      padding: 8px 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      border-right: 2px solid #0f3460;
      overflow-y: auto;
      transition: width 0.3s, opacity 0.3s;
    }
    .toolbar.collapsed {
      width: 40px;
      padding: 8px 4px;
    }
    .toolbar.collapsed .device-btn .name,
    .toolbar.collapsed .device-btn .cost,
    .toolbar.collapsed .tool-btn .name,
    .toolbar.collapsed .toolbar-section,
    .toolbar.collapsed .cable-select {
      display: none;
    }
    .toolbar-section {
      font-size: 0.6em;
      color: #666;
      text-transform: uppercase;
      margin-top: 6px;
      padding: 2px 0;
      border-bottom: 1px solid #0f3460;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .toolbar-section .collapse-btn {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 1em;
      padding: 0 2px;
    }
    .toolbar-section .collapse-btn:hover { color: #00d9ff; }
    
    /* Device grid layout */
    .device-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 4px;
    }
    .toolbar.collapsed .device-grid {
      grid-template-columns: 1fr;
    }
    .device-btn {
      background: #0f3460;
      border: 2px solid transparent;
      border-radius: 6px;
      padding: 4px 2px;
      cursor: grab;
      text-align: center;
      transition: all 0.2s;
      user-select: none;
      position: relative;
    }
    .device-btn:hover { border-color: #00d9ff; background: #1a4a7a; }
    .device-btn:active { cursor: grabbing; }
    .device-btn .icon { 
      width: 28px; 
      height: 22px; 
      margin: 0 auto 2px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .device-btn .icon svg { width: 100%; height: 100%; }
    .device-btn .name { font-size: 0.55em; line-height: 1.1; }
    .device-btn .cost { font-size: 0.5em; color: #ffd700; }
    
    /* Tooltip on hover */
    .device-btn[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      background: #0f3460;
      border: 1px solid #00d9ff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.7em;
      white-space: nowrap;
      z-index: 100;
      margin-left: 5px;
    }
    
    /* Tool buttons - horizontal row */
    .tool-row {
      display: flex;
      gap: 3px;
      flex-wrap: wrap;
    }
    .tool-btn {
      background: #0f3460;
      border: 2px solid transparent;
      border-radius: 6px;
      padding: 4px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      flex: 1;
      min-width: 28px;
    }
    .tool-btn:hover { border-color: #00d9ff; }
    .tool-btn.selected { border-color: #00d9ff; background: #1a4a7a; }
    .tool-btn .icon { font-size: 1em; }
    .tool-btn .name { font-size: 0.5em; margin-top: 1px; }
    
    /* Collapse toggle button */
    .sidebar-toggle {
      position: absolute;
      left: 90px;
      top: 50%;
      transform: translateY(-50%);
      background: #0f3460;
      border: 2px solid #00d9ff;
      border-left: none;
      border-radius: 0 8px 8px 0;
      color: #00d9ff;
      cursor: pointer;
      padding: 8px 4px;
      z-index: 50;
      transition: left 0.3s;
    }
    .sidebar-toggle:hover { background: #1a4a7a; }
    .toolbar.collapsed + .sidebar-toggle { left: 40px; }
    .sidebar-toggle .icon { font-size: 0.8em; }
    .canvas-area {
      flex: 1;
      position: relative;
      overflow: hidden;
    }
    #gameCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    
    /* ========== CONTEXT MENU ========== */
    .context-menu {
      position: fixed;
      background: #16213e;
      border: 2px solid #00d9ff;
      border-radius: 8px;
      padding: 8px 0;
      min-width: 150px;
      z-index: 500;
      display: none;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .context-menu.show { display: block; }
    .context-menu-item {
      padding: 8px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
    }
    .context-menu-item:hover { background: #1a4a7a; }
    .context-menu-item .icon { font-size: 1em; }
    .context-menu-item .label { font-size: 0.85em; }
    .context-menu-item .shortcut { 
      margin-left: auto; 
      font-size: 0.7em; 
      color: #666; 
    }
    .context-menu-divider {
      height: 1px;
      background: #0f3460;
      margin: 4px 0;
    }
    .context-menu-submenu {
      position: relative;
    }
    .context-menu-submenu > .submenu {
      position: absolute;
      left: 100%;
      top: 0;
      background: #16213e;
      border: 2px solid #00d9ff;
      border-radius: 8px;
      padding: 8px 0;
      min-width: 120px;
      display: none;
    }
    .context-menu-submenu:hover > .submenu { display: block; }
    
    /* ========== QUICK ACCESS BAR ========== */
    .quick-bar {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(22, 33, 62, 0.95);
      border: 2px solid #0f3460;
      border-radius: 12px;
      padding: 6px 10px;
      display: flex;
      gap: 6px;
      z-index: 40;
    }
    .quick-btn {
      width: 40px;
      height: 40px;
      background: #0f3460;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      position: relative;
    }
    .quick-btn:hover { border-color: #00d9ff; background: #1a4a7a; }
    .quick-btn.selected { border-color: #00d9ff; background: #1a4a7a; }
    .quick-btn .icon { font-size: 1.2em; }
    .quick-btn .key {
      position: absolute;
      top: -6px;
      right: -6px;
      background: #00d9ff;
      color: #000;
      font-size: 0.6em;
      font-weight: bold;
      padding: 1px 4px;
      border-radius: 4px;
    }
    .status-bar {
      background: #16213e;
      padding: 8px 20px;
      font-size: 0.85em;
      border-top: 2px solid #0f3460;
      display: flex;
      justify-content: space-between;
    }
    .status-bar .hint { color: #888; }
    .status-bar .connectivity { color: #00d9ff; }
    .tooltip {
      position: absolute;
      background: #0f3460;
      border: 1px solid #00d9ff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.85em;
      pointer-events: none;
      display: none;
      z-index: 100;
    }
    .check-btn {
      background: #00d9ff;
      color: #1a1a2e;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .check-btn:hover { background: #00b8d4; }
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 200;
      overflow-y: auto;
      padding: 20px 10px;
    }
    .modal.show { display: flex; }
    .modal-content {
      background: #16213e;
      border: 2px solid #00d9ff;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      max-width: 400px;
      max-height: 90vh;
      overflow-y: auto;
      margin: auto;
    }
    .modal h2 { color: #00d9ff; margin-bottom: 20px; }
    .modal .score-detail { margin: 15px 0; text-align: left; }
    .modal .score-row {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px solid #0f3460;
    }
    .modal button {
      margin-top: 20px;
      padding: 10px 30px;
      font-size: 1em;
    }
    .share-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    .twitter-btn {
      background: #1da1f2;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .twitter-btn:hover { background: #0c85d0; }
    
    /* Tutorial */
    .tutorial-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 300;
      display: none;
      overflow-y: auto;
    }
    .tutorial-overlay.show { display: flex; justify-content: center; align-items: center; }
    .tutorial-box {
      position: relative;
      background: linear-gradient(135deg, #1a1a3e, #16213e);
      border: 2px solid #00d9ff;
      border-radius: 16px;
      padding: 25px;
      max-width: 350px;
      box-shadow: 0 0 30px rgba(0,217,255,0.3);
      z-index: 301;
      margin: 20px;
    }
    .tutorial-step {
      position: absolute;
      top: -12px;
      right: 20px;
      background: #00d9ff;
      color: #000;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
    }
    .tutorial-box h3 {
      color: #00d9ff;
      margin-bottom: 10px;
      font-size: 1.2em;
    }
    .tutorial-box p {
      color: #ccc;
      line-height: 1.6;
      margin-bottom: 20px;
    }
    .tutorial-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    .tutorial-skip {
      background: transparent;
      border: 1px solid #666;
      color: #888;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
    }
    .tutorial-next {
      background: #00d9ff;
      border: none;
      color: #000;
      padding: 8px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .tutorial-highlight {
      position: absolute;
      border: 3px solid #00d9ff;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,217,255,0.5);
      pointer-events: none;
      z-index: 299;
    }
    
    /* Result enhancements */
    .result-title-badge {
      font-size: 3em;
      margin-bottom: 10px;
    }
    .result-grade {
      font-size: 2.5em;
      font-weight: bold;
      background: linear-gradient(90deg, #00d9ff, #00ff88);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .result-title-text {
      color: #ffd700;
      font-size: 1.1em;
      margin: 10px 0 20px;
    }
    .share-image-btn {
      background: linear-gradient(90deg, #ff6b6b, #ffa94d);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    
    /* Stage Select */
    .stage-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 15px;
    }
    .stage-card {
      background: rgba(0,217,255,0.1);
      border: 2px solid #0f3460;
      border-radius: 12px;
      padding: 20px 15px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    .stage-card:hover { border-color: #00d9ff; transform: translateY(-3px); }
    .stage-card.locked { opacity: 0.5; cursor: not-allowed; }
    .stage-card.cleared { border-color: #22c55e; }
    .stage-card .icon { font-size: 2.5em; margin-bottom: 10px; }
    .stage-card .name { font-weight: bold; color: #fff; }
    .stage-card .desc { font-size: 0.8em; color: #888; margin-top: 5px; }
    .stage-card .badge {
      display: inline-block;
      background: #22c55e;
      color: #000;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.7em;
      margin-top: 8px;
    }
    
    /* Requirements panel */
    .req-panel {
      position: absolute;
      top: 60px;
      right: 10px;
      background: rgba(22, 33, 62, 0.95);
      border: 1px solid #0f3460;
      border-radius: 8px;
      padding: 12px;
      font-size: 0.85em;
      max-width: 200px;
    }
    .req-panel h4 { color: #00d9ff; margin-bottom: 8px; font-size: 0.9em; }
    .req-item { display: flex; align-items: center; gap: 6px; margin: 4px 0; color: #888; }
    .req-item.met { color: #22c55e; }
    .req-item.met::before { content: '‚úì'; }
    .req-item:not(.met)::before { content: '‚óã'; }
    
    /* Lang button */
    .lang-btn {
      background: transparent;
      border: 1px solid #00d9ff;
      color: #00d9ff;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8em;
    }
    .lang-btn:hover { background: rgba(0,217,255,0.2); }
    
    /* Stage info header */
    .stage-info {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 15px;
      background: rgba(0,217,255,0.1);
      border-bottom: 1px solid #0f3460;
    }
    .stage-info .icon { font-size: 1.5em; }
    .stage-info .name { font-weight: bold; }
    .stage-info .back-btn {
      margin-left: auto;
      background: transparent;
      border: 1px solid #666;
      color: #888;
      padding: 4px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    /* Timer */
    .timer-display {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 20px;
      padding: 4px 12px;
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
    }
    .timer-label { font-size: 1.2em; }
    .timer-value {
      font-family: 'Courier New', monospace;
      font-size: 1.2em;
      font-weight: bold;
      color: #00d9ff;
      min-width: 70px;
    }
    .best-time {
      font-size: 0.8em;
      color: #888;
    }
    .best-time.new-record {
      color: #ffd700;
      animation: pulse 0.5s ease-in-out infinite alternate;
    }
    @keyframes pulse {
      from { opacity: 0.7; }
      to { opacity: 1; }
    }
    
    /* Cable Select */
    .cable-select {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 2px;
      margin-top: 4px;
      padding: 4px;
      background: rgba(0,0,0,0.3);
      border-radius: 4px;
    }
    .cable-option {
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 2px 4px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 0.55em;
      transition: background 0.2s;
    }
    .cable-option:hover { background: rgba(255,255,255,0.1); }
    .cable-option.selected { background: rgba(0,217,255,0.2); }
    .cable-color {
      width: 8px;
      height: 8px;
      border-radius: 2px;
    }
    
    /* ========== MOBILE RESPONSIVE ========== */
    @media (max-width: 768px) {
      header {
        padding: 8px 12px;
        flex-wrap: wrap;
        gap: 8px;
      }
      header h1 { font-size: 1.1em; }
      .score-panel { gap: 12px; }
      .score-item .label { font-size: 0.65em; }
      .score-item .value { font-size: 1em; }
      .main-container {
        flex-direction: column;
      }
      .toolbar {
        width: 100%;
        flex-direction: row;
        flex-wrap: nowrap;
        padding: 6px;
        border-right: none;
        border-bottom: 2px solid #0f3460;
        justify-content: flex-start;
        gap: 4px;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
      }
      .toolbar.collapsed { width: 100%; }
      .toolbar::after { display: none; }
      .sidebar-toggle { display: none; }
      .toolbar-section { display: none; }
      .device-grid {
        display: contents;
      }
      .device-btn {
        padding: 4px 6px;
        min-width: auto;
        flex: 0 0 auto;
      }
      .device-btn .icon { font-size: 1.1em; }
      .device-btn .name { display: none; }
      .device-btn[data-tooltip]:hover::after { display: none; }
      .tool-row {
        display: contents;
      }
      .tool-btn {
        padding: 4px 6px;
        min-width: auto;
        flex: 0 0 auto;
      }
      .tool-btn .icon { font-size: 1em; }
      .cable-select {
        display: flex;
        flex-direction: row;
        padding: 2px;
        flex: 0 0 auto;
      }
      .cable-option span:last-child { display: none; }
      .canvas-area {
        flex: 1;
        min-height: 300px;
      }
      .quick-bar {
        bottom: 5px;
        padding: 4px 6px;
        gap: 4px;
      }
      .quick-btn {
        width: 32px;
        height: 32px;
      }
      .quick-btn .key { display: none; }
      .context-menu { display: none !important; }
      .status-bar {
        padding: 6px 10px;
        font-size: 0.7em;
        flex-wrap: wrap;
        gap: 6px;
      }
      .status-bar .hint {
        display: none;
      }
      .status-bar .connectivity {
        flex: 1;
      }
      .check-btn {
        padding: 6px 12px;
        font-size: 0.85em;
      }
      .req-panel {
        top: auto;
        bottom: 50px;
        right: 5px;
        left: auto;
        max-width: 160px;
        font-size: 0.7em;
        padding: 6px;
        background: rgba(22, 33, 62, 0.85);
      }
      .stage-info {
        padding: 6px 10px;
        font-size: 0.85em;
      }
      .timer-display {
        margin-left: 10px;
        padding: 2px 8px;
      }
      .timer-value { font-size: 1em; min-width: 60px; }
      .cable-select {
        flex-direction: row;
        flex-wrap: wrap;
        padding: 4px;
      }
      .cable-option {
        font-size: 0.65em;
        padding: 3px 6px;
      }
      .modal {
        padding: 10px 5px;
        align-items: flex-start;
      }
      .modal-content {
        padding: 15px;
        max-width: 95%;
        margin: 10px auto;
        max-height: none;
      }
      .modal h2 { font-size: 1.2em; margin-bottom: 10px; }
      .modal .score-row { font-size: 0.85em; }
      .share-buttons {
        flex-direction: column;
      }
      .tutorial-box {
        max-width: 90%;
        padding: 15px;
        margin: 10px;
      }
      .tutorial-highlight { display: none !important; }
      .stage-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      .stage-card { padding: 12px 8px; }
      .stage-card .icon { font-size: 2em; }
      .stage-card .name { font-size: 0.9em; }
      .stage-card .desc { font-size: 0.7em; }
    }
    
    @media (max-width: 480px) {
      header {
        justify-content: center;
      }
      header svg { width: 28px; height: 28px; }
      header h1 { font-size: 0.95em; }
      .score-panel { 
        width: 100%; 
        justify-content: space-around;
        order: 2;
      }
      .lang-btn {
        position: absolute;
        top: 8px;
        right: 8px;
      }
      .toolbar {
        max-height: none;
      }
      .device-btn {
        min-width: 50px;
        padding: 4px;
      }
      .device-btn .name { display: none; }
      .tool-btn {
        min-width: 40px;
        padding: 4px;
      }
      .tool-btn .name { display: none; }
    }
    
    /* Landscape mode on mobile */
    @media (max-height: 500px) and (orientation: landscape) {
      header {
        padding: 4px 10px;
      }
      header h1 { font-size: 1em; }
      header svg { width: 24px; height: 24px; }
      .score-item .label { font-size: 0.6em; }
      .score-item .value { font-size: 0.9em; }
      .main-container {
        flex-direction: row;
      }
      .toolbar {
        width: 80px;
        flex-direction: column;
        flex-wrap: nowrap;
        max-height: none;
        overflow-y: auto;
        overflow-x: hidden;
        border-right: 2px solid #0f3460;
        border-bottom: none;
        padding: 5px;
        gap: 4px;
      }
      .toolbar-section { display: none; }
      .device-btn {
        min-width: auto;
        padding: 4px;
      }
      .device-btn .icon { width: 28px; height: 20px; }
      .device-btn .name { display: none; }
      .device-btn .cost { font-size: 0.5em; }
      .tool-btn {
        padding: 4px;
        min-width: auto;
      }
      .tool-btn .icon { font-size: 1em; }
      .tool-btn .name { display: none; }
      .cable-select {
        flex-direction: column;
        padding: 2px;
      }
      .cable-option {
        font-size: 0.6em;
        padding: 2px 4px;
      }
      .cable-option span:last-child { display: none; }
      .stage-info {
        padding: 4px 8px;
        font-size: 0.75em;
      }
      .timer-display { padding: 2px 6px; margin-left: 5px; }
      .timer-value { font-size: 0.9em; min-width: 50px; }
      .req-panel {
        bottom: 35px;
        font-size: 0.65em;
        padding: 4px;
        max-width: 140px;
      }
      .status-bar {
        padding: 4px 8px;
        font-size: 0.65em;
      }
      .check-btn {
        padding: 4px 10px;
        font-size: 0.75em;
      }
    }
    
    /* Long-press indicator for mobile */
    .long-press-ring {
      position: absolute;
      border: 3px solid #00d9ff;
      border-radius: 50%;
      pointer-events: none;
      opacity: 0;
      transform: scale(0);
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      z-index: 100;
    }
    .long-press-ring.active {
      opacity: 1;
      transform: scale(1);
      animation: longPressRing 0.5s ease-out forwards;
    }
    @keyframes longPressRing {
      0% { transform: scale(0.5); opacity: 0.5; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    
    /* Touch-friendly device buttons */
    .device-btn.touch-active {
      background: #1a4a7a;
      border-color: #00d9ff;
      transform: scale(1.05);
    }
    
    /* Mobile-specific tool tip */
    .mobile-hint {
      position: fixed;
      bottom: 70px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 217, 255, 0.9);
      color: #000;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
      z-index: 150;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    .mobile-hint.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:12px;">
      <svg width="36" height="36" viewBox="0 0 100 100">
        <circle cx="50" cy="20" r="8" fill="#00d9ff"/>
        <circle cx="20" cy="50" r="8" fill="#00d9ff"/>
        <circle cx="80" cy="50" r="8" fill="#00d9ff"/>
        <circle cx="35" cy="80" r="8" fill="#00d9ff"/>
        <circle cx="65" cy="80" r="8" fill="#00d9ff"/>
        <line x1="50" y1="20" x2="20" y2="50" stroke="#00d9ff" stroke-width="3"/>
        <line x1="50" y1="20" x2="80" y2="50" stroke="#00d9ff" stroke-width="3"/>
        <line x1="20" y1="50" x2="35" y2="80" stroke="#00d9ff" stroke-width="3"/>
        <line x1="80" y1="50" x2="65" y2="80" stroke="#00d9ff" stroke-width="3"/>
        <line x1="35" y1="80" x2="65" y2="80" stroke="#00d9ff" stroke-width="3"/>
      </svg>
      <h1 style="font-size:1.4em;">Packet Network</h1>
    </div>
    <div class="score-panel">
      <div class="score-item">
        <div class="label" data-i18n="cost">Cost</div>
        <div class="value" id="costValue">¬•0</div>
      </div>
      <div class="score-item">
        <div class="label">Cable</div>
        <div class="value" id="cableLength">0m</div>
      </div>
      <div class="score-item">
        <div class="label" data-i18n="deviceCount">Devices</div>
        <div class="value" id="deviceCount">0</div>
      </div>
      <button class="lang-btn" onclick="toggleLang()" title="üåê Language">
        <span id="langLabel">EN</span>
      </button>
    </div>
  </header>
  
  <div class="stage-info" id="stageInfo" style="display:none;">
    <span class="icon" id="stageIcon">üè†</span>
    <span class="name" id="stageName">Stage 1</span>
    <div class="timer-display">
      <span class="timer-label">‚è±</span>
      <span class="timer-value" id="timerDisplay">0:00.0</span>
      <span class="best-time" id="bestTimeDisplay"></span>
    </div>
    <button class="back-btn" onclick="showStageSelect()">‚Üê Stages</button>
  </div>
  
  <div class="main-container">
    <div class="toolbar" id="toolbar">
      <div class="toolbar-section">
        <span data-i18n="devices">Ê©üÂô®</span>
        <button class="collapse-btn" id="collapseBtn" title="Êäò„Çä„Åü„Åü„Åø">‚óÄ</button>
      </div>
      
      <div class="device-grid">
        <div class="device-btn" draggable="true" data-device="pc" data-tooltip="PC ¬•150,000">
          <div class="icon">üíª</div>
          <div class="name">PC</div>
        </div>
        
        <div class="device-btn" draggable="true" data-device="laptop" data-tooltip="„Éé„Éº„ÉàPC ¬•120,000">
          <div class="icon">üíª</div>
          <div class="name">Laptop</div>
        </div>
        
        <div class="device-btn" draggable="true" data-device="switch8" data-tooltip="L2SW 8„Éù„Éº„Éà ¬•25,000">
          <div class="icon">üü®</div>
          <div class="name">SW8</div>
        </div>
        
        <div class="device-btn" draggable="true" data-device="switch24" data-tooltip="L2SW 24„Éù„Éº„Éà ¬•80,000">
          <div class="icon">üüß</div>
          <div class="name">SW24</div>
        </div>
        
        <div class="device-btn" draggable="true" data-device="router" data-tooltip="„É´„Éº„Çø„Éº ¬•350,000">
          <div class="icon">üî¥</div>
          <div class="name">Router</div>
        </div>
        
        <div class="device-btn" draggable="true" data-device="wifiap" data-tooltip="WiFi AP ¬•15,000">
          <div class="icon">üì∂</div>
          <div class="name">WiFi</div>
        </div>
      </div>
      
      <div class="toolbar-section">
        <span data-i18n="tools">„ÉÑ„Éº„É´</span>
      </div>
      
      <div class="tool-row">
        <div class="tool-btn selected" data-tool="select" title="ÈÅ∏Êäû/ÁßªÂãï (V)">
          <div class="icon">‚¨ú</div>
        </div>
        <div class="tool-btn" data-tool="cable" title="„Ç±„Éº„Éñ„É´ (C)">
          <div class="icon">üîó</div>
        </div>
        <div class="tool-btn" data-tool="delete" title="ÂâäÈô§ (X)">
          <div class="icon">üóëÔ∏è</div>
        </div>
      </div>
      
      <div class="cable-select" id="cableSelect">
        <div class="cable-option selected" data-cable="cat6" title="Cat6 - 1Gbps, 100m">
          <span class="cable-color" style="background:#00d9ff"></span>
          <span>Cat6</span>
        </div>
        <div class="cable-option" data-cable="cat6a" title="Cat6a - 10Gbps, 100m">
          <span class="cable-color" style="background:#ffa94d"></span>
          <span>Cat6a</span>
        </div>
        <div class="cable-option" data-cable="fiber" title="Fiber - 100Gbps, 2000m">
          <span class="cable-color" style="background:#a855f7"></span>
          <span>Fiber</span>
        </div>
      </div>
    </div>
    
    <button class="sidebar-toggle" id="sidebarToggle" title="„Çµ„Ç§„Éâ„Éê„Éº„ÇíÊäò„Çä„Åü„Åü„Åø">
      <span class="icon">‚óÄ</span>
    </button>
    
    <div class="canvas-area">
      <canvas id="gameCanvas"></canvas>
      
      <!-- Quick Access Bar -->
      <div class="quick-bar" id="quickBar">
        <button class="quick-btn" data-tool="select" title="ÈÅ∏Êäû (V)">
          <span class="icon">‚¨ú</span>
          <span class="key">V</span>
        </button>
        <button class="quick-btn" data-tool="cable" title="„Ç±„Éº„Éñ„É´ (C)">
          <span class="icon">üîó</span>
          <span class="key">C</span>
        </button>
        <button class="quick-btn" data-tool="delete" title="ÂâäÈô§ (X)">
          <span class="icon">üóëÔ∏è</span>
          <span class="key">X</span>
        </button>
        <div style="width:1px;background:#0f3460;margin:0 4px;"></div>
        <button class="quick-btn" data-device="pc" title="PC (1)">
          <span class="icon">üíª</span>
          <span class="key">1</span>
        </button>
        <button class="quick-btn" data-device="switch8" title="„Çπ„Ç§„ÉÉ„ÉÅ (2)">
          <span class="icon">üü®</span>
          <span class="key">2</span>
        </button>
        <button class="quick-btn" data-device="router" title="„É´„Éº„Çø„Éº (3)">
          <span class="icon">üî¥</span>
          <span class="key">3</span>
        </button>
      </div>
      
      <div class="req-panel" id="reqPanel">
        <h4 data-i18n="requirements">üìù Requirements</h4>
        <div id="reqList"></div>
      </div>
    </div>
  </div>
  
  <!-- Context Menu -->
  <div class="context-menu" id="contextMenu">
    <div class="context-menu-item" data-action="add-pc">
      <span class="icon">üíª</span>
      <span class="label">PC„ÇíËøΩÂä†</span>
      <span class="shortcut">1</span>
    </div>
    <div class="context-menu-item" data-action="add-switch">
      <span class="icon">üü®</span>
      <span class="label">„Çπ„Ç§„ÉÉ„ÉÅ„ÇíËøΩÂä†</span>
      <span class="shortcut">2</span>
    </div>
    <div class="context-menu-item" data-action="add-router">
      <span class="icon">üî¥</span>
      <span class="label">„É´„Éº„Çø„Éº„ÇíËøΩÂä†</span>
      <span class="shortcut">3</span>
    </div>
    <div class="context-menu-item" data-action="add-wifiap">
      <span class="icon">üì∂</span>
      <span class="label">WiFi AP„ÇíËøΩÂä†</span>
      <span class="shortcut">4</span>
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" data-action="select-tool">
      <span class="icon">‚¨ú</span>
      <span class="label">ÈÅ∏Êäû„ÉÑ„Éº„É´</span>
      <span class="shortcut">V</span>
    </div>
    <div class="context-menu-item" data-action="cable-tool">
      <span class="icon">üîó</span>
      <span class="label">„Ç±„Éº„Éñ„É´„ÉÑ„Éº„É´</span>
      <span class="shortcut">C</span>
    </div>
    <div class="context-menu-item" data-action="delete-tool">
      <span class="icon">üóëÔ∏è</span>
      <span class="label">ÂâäÈô§„ÉÑ„Éº„É´</span>
      <span class="shortcut">X</span>
    </div>
  </div>
  
  <div class="status-bar">
    <span class="hint" id="hintText">üí° Ê©üÂô®„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„ÅßÈÖçÁΩÆ„ÄÇÁØÑÂõ≤ÈÅ∏Êäû„ÇÑShift+„ÇØ„É™„ÉÉ„ÇØ„ÅßË§áÊï∞ÈÅ∏Êäû„ÄÇ</span>
    <span class="connectivity" id="connectivityStatus">Êé•Á∂öÁä∂ÊÖã: Á¢∫Ë™ç‰∏≠...</span>
    <button class="check-btn" id="checkBtn">Ë®≠Ë®à„ÇíË©ï‰æ°</button>
  </div>
  
  <div class="tooltip" id="tooltip"></div>
  
  <!-- Long press indicator -->
  <div class="long-press-ring" id="longPressRing"></div>
  
  <!-- Mobile hint -->
  <div class="mobile-hint" id="mobileHint">Èï∑Êäº„Åó„Åß„Éâ„É©„ÉÉ„Ç∞</div>
  
  <!-- Stage Select Modal -->
  <div class="modal show" id="stageSelectModal">
    <div class="modal-content" style="max-width:600px;">
      <h2 style="color:#00d9ff;margin-bottom:20px;">üéÆ <span data-i18n="stages">„Çπ„ÉÜ„Éº„Ç∏</span></h2>
      <div class="stage-grid" id="stageGrid"></div>
    </div>
  </div>

  <!-- Tutorial Overlay -->
  <div class="tutorial-overlay" id="tutorialOverlay">
    <div class="tutorial-box" id="tutorialBox">
      <div class="tutorial-step" id="tutorialStep">1/5</div>
      <h3 id="tutorialTitle"></h3>
      <p id="tutorialText"></p>
      <div class="tutorial-buttons">
        <button class="tutorial-skip" onclick="skipTutorial()">„Çπ„Ç≠„ÉÉ„Éó</button>
        <button class="tutorial-next" id="tutorialNext">Ê¨°„Å∏</button>
      </div>
    </div>
    <div class="tutorial-highlight" id="tutorialHighlight"></div>
  </div>

  <div class="modal" id="resultModal">
    <div class="modal-content" style="max-width:450px;">
      <div class="result-title-badge" id="resultBadge">üèÜ</div>
      <div class="result-grade" id="resultGrade">A</div>
      <div class="result-title-text" id="resultTitleText">Áß∞Âè∑</div>
      <div class="score-detail" id="scoreDetail"></div>
      <div class="share-buttons">
        <button class="twitter-btn" id="tweetBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          <span data-i18n="tweet">„ÉÑ„Ç§„Éº„Éà</span>
        </button>
        <button class="check-btn" id="nextStageBtn" style="display:none;background:#22c55e;" onclick="goNextStage()">
          <span data-i18n="nextStage">Ê¨°„ÅÆ„Çπ„ÉÜ„Éº„Ç∏</span> ‚Üí
        </button>
        <button class="check-btn" onclick="closeModal()"><span data-i18n="retry">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</span></button>
      </div>
    </div>
  </div>

  <script src="game.js?v=20260116b"></script>
</body>
</html>
